[["index.html", "Instructions_MS2-workflow_robot Chapter 1 Prerequisites", " Instructions_MS2-workflow_robot Muyao Xi 2023-03-03 Chapter 1 Prerequisites Download OpenMS for converting the format of MS2-files (link for downloading OpenMS) Export MS2-files as .mzML from \\(dataanalysis\\) In order to install all essential packages, please run script set_up_enviroment.R under the folder of J:\\CBMR\\SUN-CBMR-Metabolomics\\Workflow\\utils\\utils_MS2_set_up before doing any step If you would like to use tools on GNPS, please register for your personal username and password You should replace the context with yours under the section with ️ You could select whether run the section with ✈️ "],["file-converter.html", "Chapter 2 File converter 2.1 Source paths on the server 2.2 Specify the polarity  2.3 Path of application of openms  2.4 Path of storing files (.mzML) exported from dataanalysis for each polarity  2.5 Conduct", " Chapter 2 File converter The script 1.Pipeline_extension_format_converter.R is available under the folder of J:\\CBMR\\SUN-CBMR-Metabolomics\\Workflow\\Script\\modules 2.1 Source paths on the server source(&quot;H:/From_SUND/Scripts/utils/utils_MS2_set_up/set_up_paths.R&quot;) 2.2 Specify the polarity  options : “POS”, “NEG”, “c(”POS”, “NEG”)” polarity &lt;- &quot;POS&quot; 2.3 Path of application of openms  path_openms &lt;- &quot;C:/Program Files/OpenMS-2.8.0/bin&quot; 2.4 Path of storing files (.mzML) exported from dataanalysis for each polarity  path_files_from_DA &lt;- &quot;H:/From_SUND/Scripts/test/MS2pos_untarget&quot; 2.5 Conduct 2.5.1 Add extension (if not available) to files exported from dataanalysis files_from_DA &lt;- list.files(path_files_from_DA, full.names = TRUE) id_not_ext &lt;- setdiff(1:length(files_from_DA), grep(&quot;\\\\.mzML$|\\\\.d$&quot;, basename(files_from_DA))) if (length(id_not_ext) != 0) { file.rename(files_from_DA[id_not_ext], paste0(files_from_DA[id_not_ext], &quot;.mzML&quot;) ) } 2.5.2 File converter for adapting to run XCMS source(paste0(path_func, &quot;/file-conversion.R&quot;)) #Create a new folder under the provided folder path_mzML_openms &lt;- paste0(path_files_from_DA, &quot;/mzML_openms_MS2_&quot;, polarity) mapply(function(x, y) file_conversion(x,y, path_openms, &quot;.mzML&quot;, &quot;.mzML&quot;), path_mzML_openms, path_files_from_DA) "],["ms2-preprocessing-untargeted.html", "Chapter 3 MS2 preprocessing untargeted 3.1 XCMS 3.2 Extraction of MS2-spectra 3.3 (Optional) CAMERA", " Chapter 3 MS2 preprocessing untargeted 3.1 XCMS The script 2a.Pipeline_XCMS.R is available under the folder of J:\\CBMR\\SUN-CBMR-Metabolomics\\Workflow\\Script\\modules\\MS2_preprocessing 3.1.1 Source paths on the server source(&quot;H:/From_SUND/Scripts/utils/utils_MS2_set_up/set_up_paths.R&quot;) 3.1.2 Load the library suppressMessages(library(MSnbase)) # suppress avoids a flood of messages library(xcms) library(dplyr) library(stats) library(parallel) library(purrr) library(magrittr) 3.1.3 Provide some essential information  3.1.3.1 Provide polarity  polarity &lt;- &quot;POS&quot; 3.1.4 Path of storing .mzML files (must have transferred by OpenMS)  path_files_mzML &lt;- &quot;H:/From_SUND/Scripts/test/MS2pos_untarget/mzML_openms_MS2_POS&quot; 3.1.5 Path of storing outputs  path_outputs &lt;- &quot;H:/From_SUND/Scripts/outputs&quot; 3.1.6 Parameters for preprocessing  3.1.6.1 Filter the compounds eluted too early and too late  rt_range &lt;- c(0.5, 15)*60 3.1.6.2 Peak picking  params &lt;- list() params$CentWave &lt;- CentWaveParam( ppm = 20, peakwidth = c(0.05,0.2)*60, snthresh = 5, noise = 1500, prefilter = c(3,1500), integrate = 2, mzdiff = -0.001, verboseColumns = TRUE, fitgauss = TRUE, extendLengthMSW = TRUE ) 3.1.6.3 Grouping for alignment  params$group1 &lt;- PeakDensityParam( sampleGroups = rep(1, length(list.files(path_files_mzML))), binSize = 0.01, bw = 2, minSamples = 1, minFraction = 0.3, maxFeatures = 20 ) 3.1.6.4 Alignment  params$PeakAlign &lt;- PeakGroupsParam( smooth = &quot;loess&quot;, span = 0.6, minFraction = 0.8, family = &quot;gaussian&quot;, extraPeaks = 3 #subset = ) 3.1.6.5 Grouping again with stricter condition after alignment  params$group2 &lt;- PeakDensityParam( sampleGroups = rep(1, length(list.files(path_files_mzML))), binSize = 0.01, bw = 1.8, minSamples = 1, minFraction = 0.6, maxFeatures = 20 ) 3.1.6.6 Gap filling  params$FillChromPeaksParam &lt;- FillChromPeaksParam(expandMz = 0, expandRt = 0, ppm = 30) 3.1.6.7 Conducting XCMS raw &lt;- readMSData(list.files(path_files_mzML, full.names = TRUE), mode = &quot;onDisk&quot;) if (grepl(&quot;ku_00007&quot;, path_files_mzML)) { source(&quot;&quot;) } else {source(paste0(path_utils_prepro, &quot;/XCMS.R&quot;))} 3.2 Extraction of MS2-spectra The script 3a.Pipeline_extract_MS2.R is available under the folder of J:\\CBMR\\SUN-CBMR-Metabolomics\\Workflow\\Script\\modules\\MS2_preprocessing 3.2.1 Source paths on the server source(&quot;H:/From_SUND/Scripts/utils/utils_MS2_set_up/set_up_paths.R&quot;) 3.2.2 Provide the polarity  polarity &lt;- &quot;POS&quot; #or &quot;NEG&quot; 3.2.3 Path of XCMSnExp object after conducting XCMS  path_rds_xcms_XCMSnExp &lt;- &quot;H:/From_SUND/Scripts/outputs/xcms_XCMSnExp_POS.rds&quot; 3.2.4 Path of storing outputs  path_outputs &lt;- &quot;H:/From_SUND/Scripts/outputs&quot; 3.2.5 Parameters for extracting MS2 spectra  params &lt;- list() 3.2.5.1 Extraction: Threshold of rt and m/z for extraction and what type of object return  params$expandRt &lt;- 15 params$expandMz &lt;- 0.01 params$return.type &lt;- &quot;Spectra&quot; #&quot;MSpectra&quot;, &quot;list&quot;, &quot;List&quot; 3.2.6 Combining: Threshold of mz, proportion among all samples, type for combining, function for combining mz and intensity  # for getting consensus spectra for each feature at each collision energy params$tolerance &lt;- 0.005 params$peaks &lt;- &quot;intersect&quot; #&quot;union&quot; #report all peaks from all input spectra params$minProp &lt;- 0.7 params$intfun &lt;- median params$mzfun &lt;- median 3.2.7 (Optional but recommended) Plot the MS2 spectra ✈️ If not, please do not run this line plot_pdf &lt;- &quot;TRUE&quot; 3.2.8 (Optional but reconmended) Reduce the number of the MS2 spectra ✈️ If not, please do not run these two lines npeaks_reduce &lt;- &quot;TRUE&quot; npeaks_remaining &lt;- 60 3.2.9 Conduct the extraction of MS2 spectra if (grepl(&quot;ku_00007&quot;, path_rds_xcms_XCMSnExp)) { source(&quot;&quot;) } else {source(paste0(path_utils_prepro, &quot;/extract_MS2.R&quot;))} 3.3 (Optional) CAMERA If you would like to get more information related to adduct, please run these lines The script 4.(optional)Pipeline_CAMERA.R is available under the folder of J:\\CBMR\\SUN-CBMR-Metabolomics\\Workflow\\Script\\modules\\MS2_preprocessing 3.3.1 Source paths on the server source(&quot;H:/From_SUND/Scripts/utils/utils_MS2_set_up/set_up_paths.R&quot;) library(CAMERA) library(commonMZ) library(dplyr) library(parallel) 3.3.2 Provide the polarity  polarity &lt;- &quot;POS&quot; 3.3.3 Path of storing outputs  path_outputs &lt;- &quot;H:/From_SUND/Scripts/outputs&quot; 3.3.4 Read XCMSnExp object after conducting XCMS  path_rds_xcms_XCMSnExp &lt;- &quot;H:/From_SUND/Scripts/outputs/xcms_XCMSnExp_NEG.rds&quot; 3.3.5 Parameters for CAMERA  params &lt;- list() 3.3.5.1 Grouping  params$perfwhm &lt;- 0.6 #percentage of the width of the FWHM (full width at half maximum) of the peak params$group_intval &lt;- &quot;into&quot; #the type of intensity value params$sigma &lt;- 6 #multiplier of the standard deviation 3.3.5.2 correlation  params$calcIso &lt;- FALSE #include isotope detection informationen for graph clustering params$calcCiS &lt;- FALSE #calculate correlation inside samples params$calsCaS &lt;- TRUE #calculate correlation accross samples params$cor_eic_th &lt;- 0.7 #correlation threshold for RIC correlation params$cor_exp_th &lt;- 0.3 #threshold for intensity correlations across samples params$pval &lt;- 1E-6 #p-value threshold for testing correlation of significance params$graphMethod &lt;- &quot;lpc&quot; #clustering method for resulting correlation graph params$intval_cor &lt;- &quot;into&quot; #selection of the intensity values 3.3.5.3 find isotopes  params$find_isoto_ppm &lt;- 10 #threshold for m/z params$mzabs &lt;- 0.01 #allowed variance for the search params$find_isoto_intval &lt;- &quot;into&quot; #choose intensity values for C12/C13 check 3.3.5.4 find adducts  params$find_addu_ppm &lt;- 10 params$mzabs &lt;- 0.01 params$multiplier &lt;- 4 #highest number(n) of allowed clusterion [nM+ion] 3.3.6 Conduct CAMERA if (grepl(&quot;ku_00007&quot;, path_rds_xcms_XCMSnExp)) { source(&quot;&quot;) } else {source(paste0(path_utils_prepro, &quot;/CAMERA.R&quot;))} "],["ms2-preprocessing-targeted.html", "Chapter 4 MS2 preprocessing targeted", " Chapter 4 MS2 preprocessing targeted "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
